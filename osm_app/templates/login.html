<!DOCTYPE html>
<html lang="en">
{% load static %}

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VeriEval - Login</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body,
    html {
      height: 100%;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #eef2f3, #ffffff);
    }

    .container {
      display: flex;
      flex-direction: row;
      height: 100vh;
      overflow: hidden;
    }

    .left-panel {
      flex: 1;
      background: linear-gradient(135deg, #002f6c, #005fa3);
      color: white;
      padding: 60px 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .left-panel .logo img {
      max-width: 140px;
      margin-bottom: 20px;
    }

    .left-panel .brand-name {
      font-size: 44px;
      font-weight: 800;
      margin-bottom: 10px;
      letter-spacing: 1px;
      color: #ffffff;
    }

    .left-panel .subtitle {
      font-size: 16px;
      color: #d4e9ff;
      margin-bottom: 30px;
    }

    .left-panel .slogan {
      font-size: 20px;
      font-style: italic;
      margin-bottom: 20px;
      color: #cfe9ff;
    }

    .left-panel .description {
      font-size: 16px;
      max-width: 480px;
      line-height: 1.6;
      color: #e6f1fc;
    }

    .right-panel {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #fefefe;
      padding: 30px;
    }

    .login-box {
      background-color: white;
      width: 100%;
      max-width: 440px;
      padding: 45px;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .login-box h2 {
      font-size: 28px;
      color: #003366;
      text-align: center;
      margin-bottom: 30px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      color: #333c57;
      font-weight: 600;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccd5e0;
      border-radius: 6px;
      font-size: 15px;
      transition: all 0.3s ease;
    }

    .form-group input:focus {
      border-color: #005fa3;
      outline: none;
      box-shadow: 0 0 5px rgba(0, 95, 163, 0.3);
    }

    .login-box button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(to right, #004a93, #007acc);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      margin-top: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .login-box button:hover {
      background: linear-gradient(to right, #003766, #0060aa);
    }

    /* Book Loader Animation - From Uiverse.io by anand_4957 with blue color accents */
    #login-loader {
      display: none;
      position: fixed;
      width: 100vw;
      height: 100vh;
      z-index: 9999;
      background: #3c3c3cf0;
      justify-content: center;
      align-items: center;
      cursor: progress;
    }

    .book,
    .book__pg-shadow,
    .book__pg {
      animation: cover 5s ease-in-out infinite;
    }

    .book {
      background-color: hsl(210, 90%, 65%);
      /* Changed to blue */
      border-radius: 0.25em;
      box-shadow:
        0 0.25em 0.5em hsla(0, 0%, 0%, 0.3),
        0 0 0 0.25em hsl(210, 100%, 57%) inset;
      /* Changed to blue */
      padding: 0.25em;
      perspective: 37.5em;
      position: relative;
      width: 8em;
      height: 6em;
      transform: translate3d(0, 0, 0);
      transform-style: preserve-3d;
    }

    .book__pg-shadow,
    .book__pg {
      position: absolute;
      left: 0.25em;
      width: calc(50% - 0.25em);
    }

    .book__pg-shadow {
      animation-name: shadow;
      background-image: linear-gradient(-45deg,
          hsla(0, 0%, 0%, 0) 50%,
          hsla(0, 0%, 0%, 0.3) 50%);
      filter: blur(0.25em);
      top: calc(100% - 0.25em);
      height: 3.75em;
      transform: scaleY(0);
      transform-origin: 100% 0%;
    }

    .book__pg {
      animation-name: pg1;
      background-color: hsl(210, 10%, 100%);
      /* Changed to blue tint */
      background-image: linear-gradient(90deg,
          hsla(210, 10%, 90%, 0) 87.5%,
          hsl(210, 10%, 90%)
          /* Changed to blue tint */
        );
      height: calc(100% - 0.5em);
      transform-origin: 100% 50%;
    }

    .book__pg--2,
    .book__pg--3,
    .book__pg--4 {
      background-image: repeating-linear-gradient(hsl(210, 10%, 10%) 0 0.125em,
          /* Changed to blue tint */
          hsla(210, 10%, 10%, 0) 0.125em 0.5em
          /* Changed to blue tint */
        ),
        linear-gradient(90deg, hsla(210, 10%, 90%, 0) 87.5%, hsl(210, 10%, 90%));
      /* Changed to blue tint */
      background-repeat: no-repeat;
      background-position: center;
      background-size:
        2.5em 4.125em,
        100% 100%;
    }

    .book__pg--2 {
      animation-name: pg2;
    }

    .book__pg--3 {
      animation-name: pg3;
    }

    .book__pg--4 {
      animation-name: pg4;
    }

    .book__pg--5 {
      animation-name: pg5;
    }

    /* Animations */
    @keyframes cover {

      from,
      5%,
      45%,
      55%,
      95%,
      to {
        animation-timing-function: ease-out;
        background-color: hsl(210, 84%, 67%);
        /* Changed to blue */
      }

      10%,
      40%,
      60%,
      90% {
        animation-timing-function: ease-in;
        background-color: hsl(210, 90%, 45%);
        /* Changed to blue */
      }
    }

    @keyframes shadow {

      from,
      10.01%,
      20.01%,
      30.01%,
      40.01% {
        animation-timing-function: ease-in;
        transform: translate3d(0, 0, 1px) scaleY(0) rotateY(0);
      }

      5%,
      15%,
      25%,
      35%,
      45%,
      55%,
      65%,
      75%,
      85%,
      95% {
        animation-timing-function: ease-out;
        transform: translate3d(0, 0, 1px) scaleY(0.2) rotateY(90deg);
      }

      10%,
      20%,
      30%,
      40%,
      50%,
      to {
        animation-timing-function: ease-out;
        transform: translate3d(0, 0, 1px) scaleY(0) rotateY(180deg);
      }

      50.01%,
      60.01%,
      70.01%,
      80.01%,
      90.01% {
        animation-timing-function: ease-in;
        transform: translate3d(0, 0, 1px) scaleY(0) rotateY(180deg);
      }

      60%,
      70%,
      80%,
      90%,
      to {
        animation-timing-function: ease-out;
        transform: translate3d(0, 0, 1px) scaleY(0) rotateY(0);
      }
    }

    @keyframes pg1 {

      from,
      to {
        animation-timing-function: ease-in-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(0.4deg);
      }

      10%,
      15% {
        animation-timing-function: ease-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(180deg);
      }

      20%,
      80% {
        animation-timing-function: ease-in;
        background-color: hsl(210, 10%, 45%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(180deg);
      }

      85%,
      90% {
        animation-timing-function: ease-in-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(180deg);
      }
    }

    @keyframes pg2 {

      from,
      to {
        animation-timing-function: ease-in;
        background-color: hsl(210, 10%, 45%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(0.3deg);
      }

      5%,
      10% {
        animation-timing-function: ease-in-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(0.3deg);
      }

      20%,
      25% {
        animation-timing-function: ease-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(179.9deg);
      }

      30%,
      70% {
        animation-timing-function: ease-in;
        background-color: hsl(210, 10%, 45%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(179.9deg);
      }

      75%,
      80% {
        animation-timing-function: ease-in-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(179.9deg);
      }

      90%,
      95% {
        animation-timing-function: ease-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(0.3deg);
      }
    }

    @keyframes pg3 {

      from,
      10%,
      90%,
      to {
        animation-timing-function: ease-in;
        background-color: hsl(210, 10%, 45%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(0.2deg);
      }

      15%,
      20% {
        animation-timing-function: ease-in-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(0.2deg);
      }

      30%,
      35% {
        animation-timing-function: ease-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(179.8deg);
      }

      40%,
      60% {
        animation-timing-function: ease-in;
        background-color: hsl(210, 10%, 45%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(179.8deg);
      }

      65%,
      70% {
        animation-timing-function: ease-in-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(179.8deg);
      }

      80%,
      85% {
        animation-timing-function: ease-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(0.2deg);
      }
    }

    @keyframes pg4 {

      from,
      20%,
      80%,
      to {
        animation-timing-function: ease-in;
        background-color: hsl(210, 10%, 45%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(0.1deg);
      }

      25%,
      30% {
        animation-timing-function: ease-in-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(0.1deg);
      }

      40%,
      45% {
        animation-timing-function: ease-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(179.7deg);
      }

      50% {
        animation-timing-function: ease-in;
        background-color: hsl(210, 10%, 45%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(179.7deg);
      }

      55%,
      60% {
        animation-timing-function: ease-in-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(179.7deg);
      }

      70%,
      75% {
        animation-timing-function: ease-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(0.1deg);
      }
    }

    @keyframes pg5 {

      from,
      30%,
      70%,
      to {
        animation-timing-function: ease-in;
        background-color: hsl(210, 10%, 45%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(0);
      }

      35%,
      40% {
        animation-timing-function: ease-in-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(0deg);
      }

      50% {
        animation-timing-function: ease-in-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(179.6deg);
      }

      60%,
      65% {
        animation-timing-function: ease-out;
        background-color: hsl(210, 10%, 100%);
        /* Changed to blue tint */
        transform: translate3d(0, 0, 1px) rotateY(0);
      }
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      .left-panel,
      .right-panel {
        flex: none;
        width: 100%;
        height: auto;
      }

      .left-panel {
        padding: 40px 20px;
      }

      .right-panel {
        padding: 30px 20px;
      }

      .login-box {
        max-width: 100%;
      }
    }
  </style>
</head>

<body>
  <!-- Login Loader -->
  <div id="login-loader">
    <div class="book">
      <div class="book__pg-shadow"></div>
      <div class="book__pg"></div>
      <div class="book__pg book__pg--2"></div>
      <div class="book__pg book__pg--3"></div>
      <div class="book__pg book__pg--4"></div>
      <div class="book__pg book__pg--5"></div>
    </div>
  </div>

  <div class="container">
    <!-- Branding Panel -->
    <div class="left-panel">
      <div class="logo">
        <!-- Replace with your logo -->

        <img src="{% static 'images/logo.jpg' %}" alt="VeriEval Logo" />
      </div>
      <div class="brand-name">VeriEval</div>
      <div class="subtitle">by Veritos Infosolutions</div>
      <div class="slogan">"Smart Decision. Simple Evaluation."</div>
      <div class="description">
        Empower educators and institutions with a next-gen digital marking system â€” fast, intuitive, and accurate.
        Join the future of evaluation with VeriEval.
      </div>
    </div>

    <!-- Login Panel -->
    <div class="right-panel">
      <div class="login-box">
        <h2>Login to VeriEval</h2>
        {% if form.errors %}
        <p style="color:red;">Invalid username or password</p>
        {% endif %}
        <form method="POST" id="loginForm">
          {% csrf_token %}
          <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" required />
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" required />
          </div>
          <button type="submit">Login</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Only show loader when login form is submitted, not on page load
    document.getElementById('loginForm').addEventListener('submit', function (e) {
      e.preventDefault(); // Prevent default form submission

      // Show loader
      const loader = document.getElementById('login-loader');
      loader.style.display = 'flex';

      // Get form data
      const formData = new FormData(this);

      // Submit form via fetch to handle errors properly
      fetch(window.location.href, {
        method: 'POST',
        body: formData,
        headers: {
          'X-Requested-With': 'XMLHttpRequest',
        },
        credentials: 'same-origin'
      })
        .then(response => {
          // Check if response is JSON (AJAX response)
          const contentType = response.headers.get('content-type');
          if (contentType && contentType.includes('application/json')) {
            return response.json().then(data => {
              if (data.success) {
                // Successful login - redirect to dashboard
                window.location.href = data.redirect_url;
              } else {
                // Login failed - show error
                showError(data.error || 'Login failed. Please try again.');
                loader.style.display = 'none';
              }
            });
          } else {
            // Handle HTML response (fallback for non-AJAX)
            if (response.ok) {
              if (response.redirected) {
                window.location.href = response.url;
              } else {
                return response.text().then(html => {
                  const tempDiv = document.createElement('div');
                  tempDiv.innerHTML = html;

                  const errorElement = tempDiv.querySelector('[style*="color:red"]');
                  if (errorElement) {
                    showError(errorElement.textContent);
                  }
                  loader.style.display = 'none';
                });
              }
            } else {
              // Handle HTTP errors (403, 500, etc.)
              handleHttpError(response);
              loader.style.display = 'none';
            }
          }
        })
        .catch(error => {
          console.error('Login error:', error);
          showError('Login failed. Please check your connection and try again.');
          loader.style.display = 'none';
        });
    });

    function showError(message) {
      let errorElement = document.querySelector('[style*="color:red"]');
      if (!errorElement) {
        errorElement = document.createElement('p');
        errorElement.style.color = 'red';
        document.getElementById('loginForm').parentNode.insertBefore(errorElement, document.getElementById('loginForm'));
      }
      errorElement.textContent = message;
    }

    function handleHttpError(response) {
      let errorMessage = 'Login failed. Please try again.';

      if (response.status === 403) {
        errorMessage = 'Security token expired. Please refresh the page and try again.';
      } else if (response.status === 500) {
        errorMessage = 'Server error. Please try again later.';
      }

      showError(errorMessage);
    }

    // Ensure loader is hidden on page load
    document.addEventListener('DOMContentLoaded', function () {
      document.getElementById('login-loader').style.display = 'none';
    });

    // Hide loader when user navigates back to login page
    window.addEventListener('pageshow', function (event) {
      // If page is shown from cache (like navigating back), hide loader
      if (event.persisted) {
        document.getElementById('login-loader').style.display = 'none';
      }
    });
  </script>
</body>

</html>