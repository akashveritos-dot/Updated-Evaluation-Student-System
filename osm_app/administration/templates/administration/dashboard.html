{% extends 'administration/base_admin.html' %}

{% block content %}
<div class="row g-4">
    <!-- Left Column: Statistics -->
    <div class="col-lg-3">
        <div class="card shadow-sm border-0 mb-4 bg-primary text-white">
            <div class="card-body">
                <h6 class="card-title text-uppercase opacity-75">Total Students</h6>
                <h2 class="display-4 fw-bold mb-0">{{ total_students }}</h2>
            </div>
        </div>
        <div class="card shadow-sm border-0 mb-4 bg-success text-white">
            <div class="card-body">
                <h6 class="card-title text-uppercase opacity-75">Total Faculty</h6>
                <h2 class="display-4 fw-bold mb-0">{{ total_faculty }}</h2>
            </div>
        </div>
        <div class="card shadow-sm border-0 mb-4 bg-warning text-dark">
            <div class="card-body">
                <h6 class="card-title text-uppercase opacity-75">Pending Allocations</h6>
                <h2 class="display-4 fw-bold mb-0">{{ pending_allocations }}</h2>
            </div>
        </div>
    </div>

    <!-- Center Column: Quick Actions -->
    <div class="col-lg-6">
        <h4 class="mb-3 fw-bold text-secondary">Quick Actions</h4>
        <div class="row g-3">
            <div class="col-md-6">
                <a href="{% url 'administration:pdf_management' %}"
                    class="card shadow-sm border-0 text-decoration-none h-100 hover-elevate">
                    <div class="card-body text-center p-4">
                        <i class="bi bi-file-earmark-pdf-fill text-danger display-4 mb-3"></i>
                        <h5 class="text-dark">Upload & Assign</h5>
                        <p class="text-muted small">Upload PDF and assign to student immediately.</p>
                    </div>
                </a>
            </div>
            <div class="col-md-6">
                <a href="{% url 'administration:allocation_management' %}"
                    class="card shadow-sm border-0 text-decoration-none h-100 hover-elevate">
                    <div class="card-body text-center p-4">
                        <i class="bi bi-person-check-fill text-primary display-4 mb-3"></i>
                        <h5 class="text-dark">Assign Faculty</h5>
                        <p class="text-muted small">Allocate active students to faculty.</p>
                    </div>
                </a>
            </div>
            <div class="col-md-6">
                <a href="{% url 'administration:user_management' %}"
                    class="card shadow-sm border-0 text-decoration-none h-100 hover-elevate">
                    <div class="card-body text-center p-4">
                        <i class="bi bi-people-fill text-info display-4 mb-3"></i>
                        <h5 class="text-dark">Manage Users</h5>
                        <p class="text-muted small">Add or remove system users.</p>
                    </div>
                </a>
            </div>
            <div class="col-md-6">
                <a href="{% url 'administration:action_logs' %}"
                    class="card shadow-sm border-0 text-decoration-none h-100 hover-elevate">
                    <div class="card-body text-center p-4">
                        <i class="bi bi-shield-lock-fill text-secondary display-4 mb-3"></i>
                        <h5 class="text-dark">Audit Logs</h5>
                        <p class="text-muted small">View system activity and security logs.</p>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Right Column: Live Status -->
    <div class="col-lg-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-bottom-0 pt-3">
                <h5 class="mb-0 fw-bold">
                    <span class="pulse-dot bg-success d-inline-block rounded-circle me-1"
                        style="width: 10px; height: 10px;"></span>
                    Live Status
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-2">Users Online (Last 30m): <strong>{{ online_users_count }}</strong></p>
                <div class="list-group list-group-flush">
                    {% for user in online_users %}
                    <div class="list-group-item px-0 py-2 d-flex align-items-center border-0">
                        <div class="avatar-sm bg-light rounded-circle d-flex align-items-center justify-content-center me-2"
                            style="width: 32px; height: 32px;">
                            <span class="text-primary fw-bold">{{ user.username|make_list|first|upper }}</span>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-0 small">{{ user.username }}</h6>
                            <small class="text-muted" style="font-size: 0.75rem;">
                                {% if user.is_superuser %}Admin{% elif user.groups.exists %}{{ user.groups.first.name
                                }}{% else %}User{% endif %}
                            </small>
                        </div>
                        <span class="badge bg-success-subtle text-success rounded-pill"
                            style="font-size: 0.6rem;">Online</span>
                    </div>
                    {% empty %}
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-moon-stars display-6 mb-2"></i>
                        <p class="small">No active users</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .hover-elevate {
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .hover-elevate:hover {
        transform: translateY(-3px);
        box-shadow: 0 .5rem 1rem rgba(0, 0, 0, .15) !important;
    }

    .pulse-dot {
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% {
            transform: scale(0.95);
            box-shadow: 0 0 0 0 rgba(25, 135, 84, 0.7);
        }

        70% {
            transform: scale(1);
            box-shadow: 0 0 0 6px rgba(25, 135, 84, 0);
        }

        100% {
            transform: scale(0.95);
            box-shadow: 0 0 0 0 rgba(25, 135, 84, 0);
        }
    }
</style>
{% endblock %}